# Telemetry Parity Dispatch Workflow

The analytics team expects telemetry parity summaries and their supporting samples to arrive in a consistent structure. Use the `telemetry:dispatch-summary` CLI to package parity reports, attach sample extracts, and stamp a manifest the warehouse can ingest.

## When to Dispatch
- After running `npm run telemetry:check-parity -- --summary-out=<path>` on a fresh telemetry batch.
- When analytics requests a re-send with additional notes or when samples change.

## Command
```bash
npm run telemetry:dispatch-summary -- \
  --summary=telemetry-artifacts/reports/act2-crossroads-parity-summary.json \
  --label=act2-crossroads-20251112 \
  --recipient=analytics@thememorysyndicate \
  --recipient=insights@thememorysyndicate \
  --note="Act 2 Crossroads QA sample" \
  --include-samples
```

### Options
| Flag | Description |
| --- | --- |
| `--summary=` | Path to the JSON summary generated by `telemetry:check-parity`. Defaults to `telemetry-artifacts/reports/act2-crossroads-parity-summary.json`. |
| `--out-dir=` | Destination root for dispatch packages. Defaults to `telemetry-artifacts/analytics/outbox`. |
| `--label=` | Optional label for the dispatch folder; if omitted the CLI derives one from the summary metadata. |
| `--recipient=` | Add a recipient (may repeat). Stored in the manifest for analytics routing. |
| `--note=` | Add a note for the analytics team (may repeat). |
| `--include-samples` | Copy any sample files referenced in the summary so analytics can replay the raw events. |

## Output Structure
```
telemetry-artifacts/analytics/outbox/<label>/
├── act2-crossroads-parity-summary.json  # copied summary
├── quest-telemetry-act2-crossroads-2025-11-12.jsonl  # copied sample (when --include-samples)
├── dispatch-manifest.json               # machine-readable metadata
└── README.md                           # human summary for quick review
```

`dispatch-manifest.json` records the checksum, recipients, notes, next steps, and copied attachments. `README.md` mirrors key details (coverage, next steps) for a fast inbox scan.

## Post-Dispatch Checklist
- Upload the dispatch folder to the analytics SFTP drop or shared drive.
- Comment in `QUEST-610` with the dispatch label and link to the manifest.
- Schedule the next telemetry sample collection if `manifest.nextSteps` still lists follow-up items.
- Track acknowledgement using `npm run telemetry:ack -- --acknowledge <label> --by "Name (Analytics)" --method email --note "ingested"` once analytics confirms ingestion; this stamps `acknowledgement.json`, appends the README log, and updates `telemetry-artifacts/analytics/acknowledgements.json`. (Flags use space-delimited values—`--acknowledge=label` will not record an update.)

### Planning the Next Parity Run
- Run `node scripts/telemetry/planQuestTelemetryParity.js --interval-days=14` (or your preferred cadence) after each acknowledgement to regenerate `telemetry-artifacts/analytics/parity-schedule.json`.
- The schedule file records the latest dispatch/acknowledgement pair, flags pending outbox folders awaiting acknowledgement, and notes when the next check becomes overdue.
- Reference the generated `nextCheckAt` timestamp when updating QUEST-610 so analytics knows exactly when the follow-up batch is expected.

## Reminder Staging & Calendar Invites
- Generate the latest reminder artifacts with `npm run telemetry:reminder` (JSON, Markdown, and `.ics` calendar invite).
- Stage the share bundle for analytics using `npm run telemetry:stage-reminder`, which mirrors the reminder outputs into `deliveries/telemetry/<dispatch-label>/telemetry-reminder-<timestamp>/` alongside a handoff README and staging manifest.
- Attach the staged folder (or link) when nudging analytics; they can import the `.ics` into shared calendars and refer to the Markdown summary for status context.
