var e=Object.defineProperty;import{E as t,C as i,S as s}from"./engine-Dl-Z51O5.js";import{R as n}from"./renderer-aVtcfGsw.js";!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver(e=>{for(const i of e)if("childList"===i.type)for(const e of i.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&t(e)}).observe(document,{childList:!0,subtree:!0})}function t(e){if(e.ep)return;e.ep=!0;const t=function(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerPolicy&&(t.referrerPolicy=e.referrerPolicy),"use-credentials"===e.crossOrigin?t.credentials="include":"anonymous"===e.crossOrigin?t.credentials="omit":t.credentials="same-origin",t}(e);fetch(e.href,t)}}();class o{constructor(){this.listeners=new Map,this.eventQueue=[],this.isProcessing=!1,this.wildcardListeners=[]}on(e,t,i=null,s=50){if(e.includes("*")){const n={pattern:e,callback:t,context:i,priority:s};return this.wildcardListeners.push(n),this.wildcardListeners.sort((e,t)=>e.priority-t.priority),()=>{const e=this.wildcardListeners.indexOf(n);-1!==e&&this.wildcardListeners.splice(e,1)}}this.listeners.has(e)||this.listeners.set(e,[]);const n={callback:t,context:i,priority:s},o=this.listeners.get(e);return o.push(n),o.sort((e,t)=>e.priority-t.priority),()=>{const t=this.listeners.get(e);if(t){const e=t.indexOf(n);-1!==e&&t.splice(e,1)}}}off(e,t){const i=this.listeners.get(e);if(!i)return;const s=i.findIndex(e=>e.callback===t);-1!==s&&i.splice(s,1)}once(e,t,i=null,s=50){const n=this.on(e,e=>{n(),t.call(i,e)},i,s);return n}emit(e,t={}){const i=this.listeners.get(e);if(i)for(let n=0;n<i.length;n++){const o=i[n];try{o.callback.call(o.context,t)}catch(s){console.error(`Error in event handler for ${e}:`,s)}}for(let n=0;n<this.wildcardListeners.length;n++){const i=this.wildcardListeners[n];if(this.matchesPattern(e,i.pattern))try{i.callback.call(i.context,{eventType:e,...t})}catch(s){console.error(`Error in wildcard handler for ${i.pattern}:`,s)}}}enqueue(e,t={}){this.eventQueue.push({eventType:e,data:t})}processQueue(){if(this.isProcessing)return;this.isProcessing=!0;const e=[...this.eventQueue];this.eventQueue=[];for(let t=0;t<e.length;t++){const i=e[t];this.emit(i.eventType,i.data)}this.isProcessing=!1}matchesPattern(e,t){const i=t.split(":"),s=e.split(":");if(i.length!==s.length)return!1;for(let n=0;n<i.length;n++)if("*"!==i[n]&&i[n]!==s[n])return!1;return!0}clear(e=null){e?this.listeners.delete(e):(this.listeners.clear(),this.wildcardListeners=[],this.eventQueue=[])}getListenerCount(e){const t=this.listeners.get(e);return t?t.length:0}getEventTypes(){return Array.from(this.listeners.keys())}getTotalListenerCount(){let e=this.wildcardListeners.length;for(const t of this.listeners.values())e+=t.length;return e}getQueuedEventCount(){return this.eventQueue.length}}const a=new o;class r{constructor(e,t={}){this.systemManager=e,this.targetFPS=t.targetFPS||60,this.onFrame=t.onFrame||null,this.targetFrameTime=1e3/this.targetFPS,this.running=!1,this.paused=!1,this.lastFrameTime=0,this.deltaTime=0,this.frameCount=0,this.fps=0,this.fpsFrameCount=0,this.fpsUpdateTime=0,this.frameTime=0,this.minFrameTime=1/0,this.maxFrameTime=0,this.totalFrameTime=0,this.rafId=null}start(){this.running?console.warn("GameLoop: Already running"):(this.running=!0,this.paused=!1,this.lastFrameTime=performance.now(),this.fpsUpdateTime=this.lastFrameTime,this.frameCount=0,this.fpsFrameCount=0,this.rafId=requestAnimationFrame(e=>this._loop(e)))}stop(){this.running&&(this.running=!1,this.paused=!1,null!==this.rafId&&(cancelAnimationFrame(this.rafId),this.rafId=null))}pause(){this.running?this.paused||(this.paused=!0):console.warn("GameLoop: Cannot pause - not running")}resume(){this.running?this.paused&&(this.paused=!1,this.lastFrameTime=performance.now()):console.warn("GameLoop: Cannot resume - not running")}_loop(e){this.running&&(this.frameTime=e-this.lastFrameTime,this.deltaTime=this.frameTime/1e3,this.lastFrameTime=e,this.frameCount++,this.fpsFrameCount++,this.paused||(this.totalFrameTime+=this.frameTime,this.minFrameTime=Math.min(this.minFrameTime,this.frameTime),this.maxFrameTime=Math.max(this.maxFrameTime,this.frameTime)),e-this.fpsUpdateTime>=1e3&&(this.fps=this.fpsFrameCount,this.fpsFrameCount=0,this.fpsUpdateTime=e),this.paused||this.systemManager.update(this.deltaTime),this.onFrame&&this.onFrame({frameCount:this.frameCount,fps:this.fps,deltaTime:this.deltaTime,frameTime:this.frameTime,paused:this.paused}),this.rafId=requestAnimationFrame(e=>this._loop(e)))}getFPS(){return this.fps}getDeltaTime(){return this.deltaTime}getFrameCount(){return this.frameCount}getFrameTime(){return this.frameTime}getAverageFrameTime(){return 0===this.frameCount?0:this.totalFrameTime/this.frameCount}getMinFrameTime(){return this.minFrameTime===1/0?0:this.minFrameTime}getMaxFrameTime(){return this.maxFrameTime}isRunning(){return this.running}isPaused(){return this.paused}resetStats(){this.minFrameTime=1/0,this.maxFrameTime=0,this.totalFrameTime=0,this.frameCount=0,this.fpsFrameCount=0}}class l{constructor(){this.audioContext=null,this.masterGain=null,this.sounds=new Map,this.music=new Map,this.initialized=!1}async init(){this.audioContext=new(window.AudioContext||window.webkitAudioContext),this.masterGain=this.audioContext.createGain(),this.masterGain.connect(this.audioContext.destination),this.initialized=!0}playSFX(e,t=1){this.initialized}playMusic(e){this.initialized}setMasterVolume(e){this.masterGain&&(this.masterGain.gain.value=Math.max(0,Math.min(1,e)))}pause(){this.audioContext&&this.audioContext.suspend()}resume(){this.audioContext&&this.audioContext.resume()}}class c{constructor(e={}){this.maxRetries=e.maxRetries??3,this.retryDelay=e.retryDelay??1e3,this.timeout=e.timeout??3e4,this.progressCallbacks=[],this.loadedCount=0,this.totalCount=0}onProgress(e){return this.progressCallbacks.push(e),()=>{const t=this.progressCallbacks.indexOf(e);-1!==t&&this.progressCallbacks.splice(t,1)}}_emitProgress(){const e=this.totalCount>0?this.loadedCount/this.totalCount*100:0;for(let i=0;i<this.progressCallbacks.length;i++)try{this.progressCallbacks[i](this.loadedCount,this.totalCount,e)}catch(t){console.error("Error in progress callback:",t)}}async loadImage(e,t=0){return new Promise((i,s)=>{const n=new Image;let o=!1;const a=setTimeout(()=>{o=!0,s(new Error(`Image load timeout: ${e}`))},this.timeout);n.onload=()=>{clearTimeout(a),o||i(n)},n.onerror=async()=>{if(clearTimeout(a),!o)if(t<this.maxRetries){console.warn(`Retry ${t+1}/${this.maxRetries} for image: ${e}`),await this._delay(this.retryDelay);try{const s=await this.loadImage(e,t+1);i(s)}catch(n){s(n)}}else s(new Error(`Failed to load image after ${this.maxRetries} attempts: ${e}`))},n.src=e})}async loadJSON(e,t=0){try{const t=new AbortController,i=setTimeout(()=>t.abort(),this.timeout),s=await fetch(e,{signal:t.signal});if(clearTimeout(i),!s.ok)throw new Error(`HTTP ${s.status}: ${s.statusText}`);return await s.json()}catch(i){if(t<this.maxRetries)return console.warn(`Retry ${t+1}/${this.maxRetries} for JSON: ${e}`),await this._delay(this.retryDelay),this.loadJSON(e,t+1);throw new Error(`Failed to load JSON after ${this.maxRetries} attempts: ${e} - ${i.message}`)}}async loadAudio(e,t=0){return new Promise((i,s)=>{const n=new Audio;let o=!1;const a=setTimeout(()=>{o=!0,s(new Error(`Audio load timeout: ${e}`))},this.timeout);n.addEventListener("canplaythrough",()=>{clearTimeout(a),o||i(n)},{once:!0}),n.addEventListener("error",async()=>{if(clearTimeout(a),!o)if(t<this.maxRetries){console.warn(`Retry ${t+1}/${this.maxRetries} for audio: ${e}`),await this._delay(this.retryDelay);try{const s=await this.loadAudio(e,t+1);i(s)}catch(n){s(n)}}else s(new Error(`Failed to load audio after ${this.maxRetries} attempts: ${e}`))},{once:!0}),n.src=e,n.load()})}async loadBatch(e){this.loadedCount=0,this.totalCount=e.length,this._emitProgress();const t=new Map,i=[];for(let s=0;s<e.length;s++){const n=e[s],o=this._loadAssetByType(n.url,n.type).then(e=>(t.set(n.url,e),this.loadedCount++,this._emitProgress(),{url:n.url,success:!0,data:e})).catch(e=>(console.error(`Failed to load asset: ${n.url}`,e),this.loadedCount++,this._emitProgress(),{url:n.url,success:!1,error:e}));i.push(o)}return await Promise.all(i),t}async _loadAssetByType(e,t){switch(t.toLowerCase()){case"image":case"img":case"png":case"jpg":case"jpeg":case"gif":case"webp":return this.loadImage(e);case"json":case"data":return this.loadJSON(e);case"audio":case"sound":case"mp3":case"ogg":case"wav":case"webm":return this.loadAudio(e);default:throw new Error(`Unknown asset type: ${t}`)}}_delay(e){return new Promise(t=>setTimeout(t,e))}resetProgress(){this.loadedCount=0,this.totalCount=0}getProgress(){const e=this.totalCount>0?this.loadedCount/this.totalCount*100:0;return{loaded:this.loadedCount,total:this.totalCount,percentage:e}}}const h="critical",d="district",u="optional";class m{constructor(e={}){this.loader=e.loader||new c,this.assets=new Map,this.loading=new Map,this.manifest=null,this.groups=new Map,this.priorityQueues={[h]:[],[d]:[],[u]:[]},this.loadingStats={[h]:{loaded:0,total:0},[d]:{loaded:0,total:0},[u]:{loaded:0,total:0}}}async loadManifest(e){try{this.manifest=await this.loader.loadJSON(e),this._buildGroups(),a.emit("asset:manifest-loaded",{manifest:this.manifest})}catch(t){throw console.error("Failed to load manifest:",t),t}}_buildGroups(){if(this.manifest&&this.manifest.assets){this.groups.clear();for(let e=0;e<this.manifest.assets.length;e++){const t=this.manifest.assets[e];t.group&&(this.groups.has(t.group)||this.groups.set(t.group,new Set),this.groups.get(t.group).add(t.id))}}}async loadAsset(e){if(this.assets.has(e)){const t=this.assets.get(e);return t.refCount++,a.emit("asset:reference-acquired",{assetId:e,refCount:t.refCount}),t.data}if(this.loading.has(e))return this.loading.get(e);const t=this._loadAssetData(e);this.loading.set(e,t);try{const i=await t;this.loading.delete(e);const s=this._getAssetInfo(e);return this.assets.set(e,{data:i,refCount:1,type:s.type,group:s.group,priority:s.priority}),a.emit("asset:loaded",{assetId:e,type:s.type}),i}catch(i){throw this.loading.delete(e),a.emit("asset:failed",{assetId:e,error:i.message}),i}}async _loadAssetData(e){const t=this._getAssetInfo(e);if(!t)throw new Error(`Asset not found in manifest: ${e}`);return a.emit("asset:loading",{assetId:e,url:t.url,type:t.type}),await this.loader._loadAssetByType(t.url,t.type)}_getAssetInfo(e){if(!this.manifest||!this.manifest.assets)return null;for(let t=0;t<this.manifest.assets.length;t++)if(this.manifest.assets[t].id===e)return this.manifest.assets[t];return null}getAsset(e){const t=this.assets.get(e);return t?t.data:null}releaseAsset(e){const t=this.assets.get(e);t&&(t.refCount--,a.emit("asset:reference-released",{assetId:e,refCount:t.refCount}),t.refCount<=0&&this._unloadAsset(e))}_unloadAsset(e){const t=this.assets.get(e);t&&(t.data&&(t.data instanceof HTMLImageElement&&(t.data.src=""),t.data instanceof HTMLAudioElement&&(t.data.pause(),t.data.src="")),this.assets.delete(e),a.emit("asset:unloaded",{assetId:e}))}async preloadGroup(e,t=null){const i=this.groups.get(e);if(!i||0===i.size)return console.warn(`Group not found or empty: ${e}`),new Map;const s=Array.from(i).map(e=>{const i=this._getAssetInfo(e);return{id:e,url:i.url,type:i.type,priority:t||i.priority}});return this.preloadAssets(s)}async preloadAssets(e){const t=[],i=[],s=[];for(let o=0;o<e.length;o++){const n=e[o];switch(n.priority){case h:t.push(n);break;case d:i.push(n);break;default:s.push(n)}}const n=new Map;if(t.length>0){a.emit("asset:priority-loading",{priority:h,count:t.length});const e=await this._loadPriorityBatch(t,h);for(const[t,i]of e)n.set(t,i)}if(i.length>0){a.emit("asset:priority-loading",{priority:d,count:i.length});const e=await this._loadPriorityBatch(i,d);for(const[t,i]of e)n.set(t,i)}return s.length>0&&(a.emit("asset:priority-loading",{priority:u,count:s.length}),this._loadPriorityBatch(s,u).catch(e=>{console.warn("Optional asset loading failed:",e)})),n}async _loadPriorityBatch(e,t){this.loadingStats[t].loaded=0,this.loadingStats[t].total=e.length;const i=new Map,s=[];for(let n=0;n<e.length;n++){const o=e[n],a=this.loadAsset(o.id).then(e=>{i.set(o.id,e),this.loadingStats[t].loaded++,this._emitPriorityProgress(t)}).catch(e=>{console.error(`Failed to load ${t} asset ${o.id}:`,e),this.loadingStats[t].loaded++,this._emitPriorityProgress(t)});s.push(a)}return await Promise.all(s),i}_emitPriorityProgress(e){const t=this.loadingStats[e],i=t.total>0?t.loaded/t.total*100:0;a.emit("asset:progress",{priority:e,loaded:t.loaded,total:t.total,percentage:i})}unloadGroup(e){const t=this.groups.get(e);if(t){for(const e of t){const t=this.assets.get(e);t&&(t.refCount=0,this._unloadAsset(e))}a.emit("asset:group-unloaded",{groupName:e})}}unloadUnused(){const e=[];for(const[t,i]of this.assets)i.refCount<=0&&e.push(t);for(let t=0;t<e.length;t++)this._unloadAsset(e[t]);a.emit("asset:cleanup",{unloaded:e.length})}getLoadingStats(e){const t=this.loadingStats[e],i=t.total>0?t.loaded/t.total*100:0;return{loaded:t.loaded,total:t.total,percentage:i}}getStats(){return{loaded:this.assets.size,loading:this.loading.size,groups:this.groups.size,memory:this._estimateMemoryUsage()}}_estimateMemoryUsage(){let e=0;for(const t of this.assets.values())t.data instanceof HTMLImageElement?e+=t.data.width*t.data.height*4:"object"==typeof t.data&&(e+=2*JSON.stringify(t.data).length);return e}clear(){for(const e of this.assets.keys())this._unloadAsset(e);this.assets.clear(),this.loading.clear(),this.groups.clear(),this.manifest=null;for(const e in this.loadingStats)this.loadingStats[e].loaded=0,this.loadingStats[e].total=0;a.emit("asset:cleared")}}const g=class e{constructor(t="Global",i=e.LogLevel.INFO){this.context=t,this.level=i,this.logs=[],this.maxLogs=100}setLevel(e){this.level=e}getTimestamp(){const e=new Date;return`${String(e.getHours()).padStart(2,"0")}:${String(e.getMinutes()).padStart(2,"0")}:${String(e.getSeconds()).padStart(2,"0")}.${String(e.getMilliseconds()).padStart(3,"0")}`}format(e,t){return`[${this.getTimestamp()}] [${e}] [${this.context}] ${t}`}store(e,t){this.logs.push({timestamp:Date.now(),level:e,context:this.context,message:t}),this.logs.length>this.maxLogs&&this.logs.shift()}debug(...t){if(this.level<=e.LogLevel.DEBUG){const e=t.join(" ");console.log(this.format("DEBUG",e)),this.store("DEBUG",e)}}info(...t){if(this.level<=e.LogLevel.INFO){const e=t.join(" ");console.log(this.format("INFO",e)),this.store("INFO",e)}}warn(...t){if(this.level<=e.LogLevel.WARN){const e=t.join(" ");console.warn(this.format("WARN",e)),this.store("WARN",e)}}error(...t){if(this.level<=e.LogLevel.ERROR){const e=t.join(" ");console.error(this.format("ERROR",e)),this.store("ERROR",e)}}getLogs(){return this.logs}clearLogs(){this.logs=[]}exportLogs(){return JSON.stringify(this.logs,null,2)}};var p;((t,i,s)=>{i in t?e(t,i,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[i]=s})(g,"symbol"!=typeof(p="LogLevel")?p+"":p,{DEBUG:0,INFO:1,WARN:2,ERROR:3,NONE:4});let y=g;class f{constructor(e){this.canvas=e,this.logger=new y("Engine",y.LogLevel.INFO),this.eventBus=new o,this.entityManager=new t,this.componentRegistry=new i(this.entityManager),this.systemManager=new s(this.entityManager,this.componentRegistry,this.eventBus),this.gameLoop=new r(this.systemManager,{targetFPS:60,onFrame:e=>this._onFrame(e)}),this.renderer=new n(e),this.audioManager=new l,this.assetManager=new m,this.logger.info("Engine initialized")}async init(){this.logger.info("Initializing engine..."),await this.audioManager.init(),this.systemManager.init(),this.logger.info("Engine ready")}registerSystem(e,t){this.systemManager.registerSystem(e,t),this.logger.debug(`Registered system: ${t}`)}start(){this.gameLoop.isRunning()?this.logger.warn("Engine already running"):(this.logger.info("Engine started"),this.gameLoop.start())}stop(){this.logger.info("Engine stopped"),this.gameLoop.stop()}pause(){this.logger.info("Engine paused"),this.gameLoop.pause()}resume(){this.logger.info("Engine resumed"),this.gameLoop.resume()}_onFrame(e){this.renderer.render(this.componentRegistry),this.eventBus.processQueue()}getEntityManager(){return this.entityManager}getComponentRegistry(){return this.componentRegistry}getSystemManager(){return this.systemManager}getEventBus(){return this.eventBus}getRenderer(){return this.renderer}getAudioManager(){return this.audioManager}getAssetManager(){return this.assetManager}getFPS(){return this.gameLoop.getFPS()}getDeltaTime(){return this.gameLoop.getDeltaTime()}getGameLoop(){return this.gameLoop}isRunning(){return this.gameLoop.isRunning()}isPaused(){return this.gameLoop.isPaused()}cleanup(){this.logger.info("Cleaning up engine..."),this.gameLoop.stop(),this.systemManager.cleanup(),this.eventBus.clear(),this.logger.info("Engine cleaned up")}}const v={player:{moveSpeed:200,acceleration:1200,friction:.85,observationRadius:96,detectiveVisionDuration:5e3,detectiveVisionCooldown:1e4},faction:{cascadeMultiplier:.5,attitudeThresholds:{allied:{fame:80,infamy:0},friendly:{fame:40,infamy:0},neutral:{fame:0,infamy:0},hostile:{fame:0,infamy:30}}},knowledge:{gateCheckInterval:500},camera:{followSpeed:.1,lookAheadDistance:100,deadzone:32}};function w(e){return{police:{allied:{fame:75,infamy:0},friendly:{fame:35,infamy:5},neutral:{fame:0,infamy:0},hostile:{fame:0,infamy:25}},criminals:{allied:{fame:80,infamy:20},friendly:{fame:40,infamy:0},neutral:{fame:0,infamy:0},hostile:{fame:0,infamy:40}}}[e]||v.faction.attitudeThresholds}class C{constructor(e,t,i){this.components=e,this.events=t,this.input=i,this.requiredComponents=["PlayerController","Transform"]}init(){this.events.subscribe("game:pause",()=>{this.paused=!0}),this.events.subscribe("game:resume",()=>{this.paused=!1}),this.paused=!1}update(e,t){if(this.paused)return;const i=t.filter(e=>e.hasTag&&e.hasTag("player"));if(0===i.length)return;const s=i[0],n=this.components.getComponent(s.id,"PlayerController"),o=this.components.getComponent(s.id,"Transform");if(!n||!o)return;const a=this.input.getMovementVector();if(0!==a.x||0!==a.y){const t=n.acceleration*e;n.velocityX+=a.x*t,n.velocityY+=a.y*t,this.events.emit("player:moving",{direction:{x:a.x,y:a.y},position:{x:o.x,y:o.y}})}n.velocityX*=n.friction,n.velocityY*=n.friction;const r=Math.sqrt(n.velocityX*n.velocityX+n.velocityY*n.velocityY);if(r>n.moveSpeed){const e=n.moveSpeed/r;n.velocityX*=e,n.velocityY*=e}Math.abs(n.velocityX)<.1&&(n.velocityX=0),Math.abs(n.velocityY)<.1&&(n.velocityY=0);const l=o.x,c=o.y;o.x+=n.velocityX*e,o.y+=n.velocityY*e;Math.sqrt((o.x-l)**2+(o.y-c)**2)>1&&this.events.emit("player:moved",{from:{x:l,y:c},to:{x:o.x,y:o.y},velocity:{x:n.velocityX,y:n.velocityY}}),this.updateControllerInput(n)}updateControllerInput(e){e.input.moveLeft=this.input.isPressed("moveLeft"),e.input.moveRight=this.input.isPressed("moveRight"),e.input.moveUp=this.input.isPressed("moveUp"),e.input.moveDown=this.input.isPressed("moveDown"),e.input.interact=this.input.isPressed("interact"),e.input.deductionBoard=this.input.isPressed("deductionBoard"),e.input.inventory=this.input.isPressed("inventory"),e.input.pause=this.input.isPressed("pause")}cleanup(){this.events.unsubscribe("game:pause"),this.events.unsubscribe("game:resume")}}class S{constructor(e,t){this.components=e,this.events=t,this.requiredComponents=["Transform"],this.playerKnowledge=new Set,this.playerAbilities=new Set,this.playerCasesSolved=new Set,this.collectedEvidence=new Map,this.discoveredClues=new Map,this.activeCase=null,this.detectiveVisionActive=!1,this.detectiveVisionTimer=0,this.detectiveVisionCooldown=0}init(){this.playerAbilities.add("basic_observation"),console.log("[InvestigationSystem] Initialized")}update(e,t){this.updateDetectiveVision(e);const i=t.find(e=>e.hasTag&&e.hasTag("player"));if(!i)return;const s=this.components.getComponent(i.id,"Transform");s&&(this.scanForEvidence(s,t),this.checkInteractionZones(i,s,t))}updateDetectiveVision(e){this.detectiveVisionActive&&(this.detectiveVisionTimer-=e,this.detectiveVisionTimer<=0&&this.deactivateDetectiveVision()),this.detectiveVisionCooldown>0&&(this.detectiveVisionCooldown-=e)}scanForEvidence(e,t){const i=v.player.observationRadius,s=i*i;for(const n of t){const t=this.components.getComponent(n.id,"Evidence");if(!t||t.collected)continue;const i=this.components.getComponent(n.id,"Transform");if(!i)continue;const o=i.x-e.x,a=i.y-e.y,r=o*o+a*a;if(r<=s){(!t.hidden||this.detectiveVisionActive)&&this.events.emit("evidence:detected",{entityId:n.id,evidenceId:t.id,distance:Math.sqrt(r),position:{x:i.x,y:i.y}})}}}checkInteractionZones(e,t,i){const s=this.components.getComponent(e.id,"PlayerController");if(!s)return;const n=s.input.interact;for(const o of i){const e=this.components.getComponent(o.id,"InteractionZone");if(!e||!e.active)continue;const i=this.components.getComponent(o.id,"Transform");i&&(e.isInRange(t,i)&&"evidence"===e.type&&(n||!e.requiresInput?this.collectEvidence(o.id,e.data.evidenceId):this.events.emit("ui:show_prompt",{text:e.prompt,position:{x:i.x,y:i.y}})))}}collectEvidence(e,t){const i=this.components.getComponent(e,"Evidence");i&&!i.collected&&(i.canCollect(this.playerAbilities)?(i.collect(),this.collectedEvidence.has(i.caseId)||this.collectedEvidence.set(i.caseId,new Set),this.collectedEvidence.get(i.caseId).add(t),this.events.emit("evidence:collected",{evidenceId:t,caseId:i.caseId,type:i.type,category:i.category,entityId:e}),this.checkClueDerivation(i),console.log(`[InvestigationSystem] Collected evidence: ${i.title}`)):this.events.emit("evidence:collection_failed",{evidenceId:t,reason:"missing_ability",required:i.requires}))}checkClueDerivation(e){for(const t of e.derivedClues)this.discoveredClues.has(t)||(this.events.emit("clue:derived",{clueId:t,evidenceId:e.id,caseId:e.caseId}),console.log(`[InvestigationSystem] New clue derived: ${t}`))}activateDetectiveVision(){this.detectiveVisionCooldown>0?this.events.emit("ability:cooldown",{ability:"detective_vision",remaining:this.detectiveVisionCooldown}):this.playerAbilities.has("detective_vision")?(this.detectiveVisionActive=!0,this.detectiveVisionTimer=v.player.detectiveVisionDuration/1e3,this.events.emit("detective_vision:activated",{duration:this.detectiveVisionTimer}),console.log("[InvestigationSystem] Detective vision activated")):this.events.emit("ability:locked",{ability:"detective_vision"})}deactivateDetectiveVision(){this.detectiveVisionActive=!1,this.detectiveVisionCooldown=v.player.detectiveVisionCooldown/1e3,this.events.emit("detective_vision:deactivated",{cooldown:this.detectiveVisionCooldown}),console.log("[InvestigationSystem] Detective vision deactivated")}unlockAbility(e){this.playerAbilities.has(e)||(this.playerAbilities.add(e),this.events.emit("ability:unlocked",{abilityId:e}),console.log(`[InvestigationSystem] Ability unlocked: ${e}`))}learnKnowledge(e){this.playerKnowledge.has(e)||(this.playerKnowledge.add(e),this.events.emit("knowledge:learned",{knowledgeId:e}),console.log(`[InvestigationSystem] Knowledge learned: ${e}`))}solveCase(e,t=1){this.playerCasesSolved.has(e)||(this.playerCasesSolved.add(e),this.events.emit("case:solved",{caseId:e,accuracy:t,evidenceCollected:this.collectedEvidence.get(e)?.size||0}),console.log(`[InvestigationSystem] Case solved: ${e} (${(100*t).toFixed(0)}% accuracy)`))}getPlayerState(){return{knowledge:this.playerKnowledge,abilities:this.playerAbilities,casesSolved:this.playerCasesSolved,factionReputation:new Map}}cleanup(){this.collectedEvidence.clear(),this.discoveredClues.clear()}}class b{constructor(e,t){this.components=e,this.events=t,this.requiredComponents=["FactionMember"],this.factionRelationships=this.initializeFactionRelationships(),this.districtControl=new Map,this.playerFactionMember=null}initializeFactionRelationships(){const e=new Map;return e.set("police",{allies:["neurosynch"],enemies:["criminals","resistance"]}),e.set("criminals",{allies:[],enemies:["police","neurosynch"]}),e.set("neurosynch",{allies:["police"],enemies:["resistance","criminals"]}),e.set("resistance",{allies:[],enemies:["police","neurosynch"]}),e.set("civilian",{allies:[],enemies:[]}),e}init(){this.events.subscribe("evidence:collected",e=>{this.onEvidenceCollected(e)}),this.events.subscribe("case:solved",e=>{this.onCaseSolved(e)}),this.districtControl.set("downtown","police"),this.districtControl.set("industrial","criminals"),this.districtControl.set("corporate_spires","neurosynch"),this.districtControl.set("archive_undercity","resistance"),console.log("[FactionReputationSystem] Initialized")}update(e,t){if(!this.playerFactionMember){const e=t.find(e=>e.hasTag&&e.hasTag("player"));e&&(this.playerFactionMember=this.components.getComponent(e.id,"FactionMember"))}this.playerFactionMember&&this.playerFactionMember.currentDisguise&&this.checkDisguiseDetection(t,e)}onEvidenceCollected(e){console.log(`[FactionReputationSystem] Evidence collected for case: ${e.caseId}`)}onCaseSolved(e){this.playerFactionMember&&this.modifyReputation("police",10,0,"Case solved")}modifyReputation(e,t,i,s=""){if(!this.playerFactionMember)return;const n=this.playerFactionMember.getReputation(e),o=this.playerFactionMember.getAttitude(e,w(e));this.playerFactionMember.modifyReputation(e,t,i);const a=this.playerFactionMember.getReputation(e),r=this.playerFactionMember.getAttitude(e,w(e));this.events.emit("reputation:changed",{factionId:e,oldFame:n.fame,newFame:a.fame,oldInfamy:n.infamy,newInfamy:a.infamy,reason:s}),o!==r&&(this.events.emit("faction:attitude_changed",{factionId:e,oldAttitude:o,newAttitude:r}),console.log(`[FactionReputationSystem] ${e} attitude: ${o} â†’ ${r}`)),this.cascadeReputation(e,t,i),console.log(`[FactionReputationSystem] ${e} reputation: ${a.fame} fame, ${a.infamy} infamy (${s})`)}cascadeReputation(e,t,i){const s=this.factionRelationships.get(e);if(!s)return;const n=v.faction.cascadeMultiplier;for(const o of s.allies){const e=Math.floor(t*n),s=Math.floor(i*n);0===e&&0===s||(this.playerFactionMember.modifyReputation(o,e,s),console.log(`[FactionReputationSystem] Cascade to ${o} (ally): ${e>0?"+":""}${e} fame`))}for(const o of s.enemies){const e=-Math.floor(t*n),s=Math.floor(i*n);0===e&&0===s||(this.playerFactionMember.modifyReputation(o,e,s),console.log(`[FactionReputationSystem] Cascade to ${o} (enemy): ${e} fame`))}}checkDisguiseDetection(e,t){}equipDisguise(e){this.playerFactionMember&&(this.playerFactionMember.equipDisguise(e),this.events.emit("disguise:equipped",{factionId:e}),console.log(`[FactionReputationSystem] Disguise equipped: ${e}`))}removeDisguise(){if(!this.playerFactionMember)return;const e=this.playerFactionMember.currentDisguise;this.playerFactionMember.removeDisguise(),this.events.emit("disguise:removed",{factionId:e}),console.log("[FactionReputationSystem] Disguise removed")}getDistrictController(e){return this.districtControl.get(e)||"civilian"}cleanup(){this.events.unsubscribe("evidence:collected"),this.events.unsubscribe("case:solved")}}class F{constructor(e,t,i){this.components=e,this.events=t,this.investigation=i,this.requiredComponents=["KnowledgeGate"],this.gateCheckTimer=0,this.gateCheckInterval=v.knowledge.gateCheckInterval/1e3}init(){this.events.subscribe("knowledge:learned",()=>{this.checkAllGates()}),this.events.subscribe("ability:unlocked",()=>{this.checkAllGates()}),this.events.subscribe("case:solved",()=>{this.checkAllGates()}),console.log("[KnowledgeProgressionSystem] Initialized")}update(e,t){this.gateCheckTimer-=e,this.gateCheckTimer<=0&&(this.checkAllGates(t),this.gateCheckTimer=this.gateCheckInterval)}checkAllGates(e){if(!e)return;const t=this.getPlayerState();for(const i of e){const e=this.components.getComponent(i.id,"KnowledgeGate");e&&!e.unlocked&&(e.checkRequirements(t)&&this.unlockGate(i.id,e))}}unlockGate(e,t){t.unlock();const i=this.components.getComponent(e,"Transform");this.events.emit("gate:unlocked",{gateId:t.id,type:t.type,entityId:e,position:i?{x:i.x,y:i.y}:null}),console.log(`[KnowledgeProgressionSystem] Gate unlocked: ${t.id} (${t.type})`)}getPlayerState(){const e=this.investigation.getPlayerState();return e.factionReputation=new Map,e}canAccessArea(e){return!0}cleanup(){this.events.unsubscribe("knowledge:learned"),this.events.unsubscribe("ability:unlocked"),this.events.unsubscribe("case:solved")}}class M{constructor(e,t){this.components=e,this.events=t,this.activeDialogue=null,this.dialogueHistory=new Map}init(){console.log("[DialogueSystem] Initialized (stub)")}update(e,t){}startDialogue(e,t){this.activeDialogue={npcId:e,dialogueId:t,currentNode:"start",choices:[]},this.events.emit("dialogue:started",{npcId:e,dialogueId:t}),console.log(`[DialogueSystem] Started dialogue: ${t} with NPC: ${e}`)}endDialogue(){if(!this.activeDialogue)return;const{npcId:e,dialogueId:t}=this.activeDialogue;this.events.emit("dialogue:ended",{npcId:e,dialogueId:t}),this.activeDialogue=null,console.log("[DialogueSystem] Dialogue ended")}selectChoice(e){this.activeDialogue&&this.events.emit("dialogue:choice_selected",{dialogueId:this.activeDialogue.dialogueId,choice:e})}cleanup(){this.activeDialogue=null}}class I{constructor(e,t,i){this.components=e,this.events=t,this.camera=i,this.requiredComponents=["Transform","PlayerController"],this.targetX=0,this.targetY=0,this.velocityX=0,this.velocityY=0}init(){console.log("[CameraFollowSystem] Initialized")}update(e,t){const i=t.find(e=>e.hasTag&&e.hasTag("player"));if(!i)return;const s=this.components.getComponent(i.id,"Transform"),n=this.components.getComponent(i.id,"PlayerController");if(!s||!n)return;const o=v.camera.lookAheadDistance,a=Math.sqrt(n.velocityX**2+n.velocityY**2);let r=0,l=0;a>.1&&(r=n.velocityX/a*o,l=n.velocityY/a*o),this.targetX=s.x+r,this.targetY=s.y+l;const c=v.camera.deadzone,h=this.targetX-this.camera.x,d=this.targetY-this.camera.y;if(Math.sqrt(h*h+d*d)<c)return;const u=v.camera.followSpeed;this.camera.x+=(this.targetX-this.camera.x)*u,this.camera.y+=(this.targetY-this.camera.y)*u,this.camera.x=Math.round(this.camera.x),this.camera.y=Math.round(this.camera.y)}shake(e,t){this.camera&&this.camera.shake&&this.camera.shake(e,t),this.events.emit("camera:shake",{intensity:e,duration:t})}snapTo(e,t){this.camera&&(this.camera.x=e,this.camera.y=t),this.targetX=e,this.targetY=t}cleanup(){}}class T{constructor(e=0,t=0,i=0,s=1,n=1){this.x=e,this.y=t,this.rotation=i,this.scaleX=s,this.scaleY=n}setPosition(e,t){this.x=e,this.y=t}translate(e,t){this.x+=e,this.y+=t}distanceTo(e){const t=e.x-this.x,i=e.y-this.y;return Math.sqrt(t*t+i*i)}clone(){return new T(this.x,this.y,this.rotation,this.scaleX,this.scaleY)}}class x{constructor({image:e=null,width:t=32,height:i=32,layer:s="entities",zIndex:n=0,visible:o=!0,alpha:a=1,color:r="#FFFFFF"}={}){this.image=e,this.width=t,this.height=i,this.layer=s,this.zIndex=n,this.visible=o,this.alpha=a,this.color=r}show(){this.visible=!0}hide(){this.visible=!1}setAlpha(e){this.alpha=Math.max(0,Math.min(1,e))}}class R{constructor({moveSpeed:e=200,acceleration:t=1200,friction:i=.85}={}){this.input={moveLeft:!1,moveRight:!1,moveUp:!1,moveDown:!1,interact:!1,deductionBoard:!1,inventory:!1,pause:!1},this.moveSpeed=e,this.acceleration=t,this.friction=i,this.velocityX=0,this.velocityY=0}resetInput(){Object.keys(this.input).forEach(e=>{this.input[e]=!1})}isMoving(){return this.input.moveLeft||this.input.moveRight||this.input.moveUp||this.input.moveDown}}class A{constructor({type:e="AABB",width:t=32,height:i=32,radius:s=16,offsetX:n=0,offsetY:o=0,isTrigger:a=!1,isStatic:r=!1,tags:l=[]}={}){this.type=e,this.width=t,this.height=i,this.radius=s,this.offsetX=n,this.offsetY=o,this.isTrigger=a,this.isStatic=r,this.tags=l}getBounds(e){if("AABB"===this.type){const t=e.x+this.offsetX,i=e.y+this.offsetY;return{minX:t-this.width/2,minY:i-this.height/2,maxX:t+this.width/2,maxY:i+this.height/2}}if("circle"===this.type){const t=e.x+this.offsetX,i=e.y+this.offsetY;return{minX:t-this.radius,minY:i-this.radius,maxX:t+this.radius,maxY:i+this.radius}}return{minX:0,minY:0,maxX:0,maxY:0}}hasTag(e){return this.tags.includes(e)}}class E{constructor({primaryFaction:e="civilian",reputation:t={},currentDisguise:i=null,knownBy:s=new Set,relationshipModifiers:n=[]}={}){this.primaryFaction=e,this.reputation=new Map(Object.entries(t)),this.currentDisguise=i,this.knownBy=s,this.relationshipModifiers=n}getReputation(e){return this.reputation.has(e)||this.reputation.set(e,{fame:0,infamy:0}),this.reputation.get(e)}modifyReputation(e,t=0,i=0){const s=this.getReputation(e);s.fame=Math.max(0,Math.min(100,s.fame+t)),s.infamy=Math.max(0,Math.min(100,s.infamy+i))}getAttitude(e,t){const i=this.getReputation(e);return i.fame>=t.allied.fame&&i.infamy<=t.allied.infamy?"allied":i.fame>=t.friendly.fame&&i.infamy<=t.friendly.infamy?"friendly":i.infamy>=t.hostile.infamy?"hostile":"neutral"}equipDisguise(e){this.currentDisguise=e}removeDisguise(){this.currentDisguise=null}isKnownBy(e){return this.knownBy.has(e)}markKnownBy(e){this.knownBy.add(e)}}class k{constructor({id:e="",type:t="physical",category:i="generic",title:s="Evidence",description:n="A piece of evidence",caseId:o="",collected:a=!1,analyzed:r=!1,hidden:l=!1,requires:c=null,derivedClues:h=[]}={}){this.id=e,this.type=t,this.category=i,this.title=s,this.description=n,this.caseId=o,this.collected=a,this.analyzed=r,this.hidden=l,this.requires=c,this.derivedClues=h}canCollect(e){return!this.collected&&(!this.requires||e.has(this.requires))}collect(){this.collected=!0}analyze(){this.analyzed=!0}}class ${constructor({id:e="",type:t="trigger",radius:i=64,requiresInput:s=!0,prompt:n="Press E to interact",active:o=!0,oneShot:a=!1,used:r=!1,data:l={}}={}){this.id=e,this.type=t,this.radius=i,this.requiresInput=s,this.prompt=n,this.active=o,this.oneShot=a,this.used=r,this.data=l}isInRange(e,t){return e.distanceTo(t)<=this.radius}interact(){return!(!this.active||this.oneShot&&this.used)&&(this.oneShot&&(this.used=!0),!0)}activate(){this.active=!0}deactivate(){this.active=!1}reset(){this.used=!1}}function P(e,t,i){const{x:s=0,y:n=0,id:o=`evidence_${Date.now()}`,type:a="physical",category:r="generic",title:l="Evidence",description:c="A piece of evidence",caseId:h="case_tutorial",hidden:d=!1,requires:u=null,derivedClues:m=[]}=i,g=e.createEntity();e.tagEntity(g,"evidence");const p=new T(s,n,0,1,1);t.addComponent(g,"Transform",p);const y=new x({image:null,width:24,height:24,layer:"entities",zIndex:5,color:D(a),visible:!d,alpha:d?.3:1});t.addComponent(g,"Sprite",y);const f=new k({id:o,type:a,category:r,title:l,description:c,caseId:h,collected:!1,analyzed:!1,hidden:d,requires:u,derivedClues:m});t.addComponent(g,"Evidence",f);const v=new $({id:`interaction_${o}`,type:"evidence",radius:48,requiresInput:!0,prompt:`Press E to collect: ${l}`,active:!0,oneShot:!0,data:{evidenceId:o,caseId:h}});t.addComponent(g,"InteractionZone",v);const w=new A({type:"circle",radius:12,isTrigger:!0,isStatic:!0,tags:["evidence"]});return t.addComponent(g,"Collider",w),console.log(`[EvidenceEntity] Created evidence: ${l} at (${s}, ${n})`),g}function D(e){return{physical:"#FFAA00",digital:"#00FFFF",testimony:"#FF00FF",forensic:"#00FF00"}[e]||"#FFFFFF"}const L={moveUp:["KeyW","ArrowUp"],moveDown:["KeyS","ArrowDown"],moveLeft:["KeyA","ArrowLeft"],moveRight:["KeyD","ArrowRight"],interact:["KeyE"],deductionBoard:["Tab"],inventory:["KeyI"],pause:["Escape"],detectiveVision:["KeyV"],forensicAnalysis:["KeyF"],attack:["Space"],dodge:["Shift"],confirm:["Enter","Space"],cancel:["Escape"],debugToggle:["Backquote"]};class B{constructor(){this.keys=new Map,this.actions=new Map,Object.keys(L).forEach(e=>{this.actions.set(e,!1)}),this.bindEvents()}bindEvents(){window.addEventListener("keydown",e=>this.handleKeyDown(e)),window.addEventListener("keyup",e=>this.handleKeyUp(e))}handleKeyDown(e){this.isGameKey(e.code)&&e.preventDefault(),this.keys.set(e.code,!0),this.updateActions()}handleKeyUp(e){this.keys.set(e.code,!1),this.updateActions()}updateActions(){for(const[e,t]of Object.entries(L)){const i=t.some(e=>this.keys.get(e));this.actions.set(e,i)}}isPressed(e){return this.actions.get(e)||!1}isGameKey(e){return Object.values(L).flat().includes(e)}reset(){this.keys.clear(),this.actions.forEach((e,t)=>{this.actions.set(t,!1)})}getMovementVector(){let e=0,t=0;if(this.isPressed("moveLeft")&&(e-=1),this.isPressed("moveRight")&&(e+=1),this.isPressed("moveUp")&&(t-=1),this.isPressed("moveDown")&&(t+=1),0!==e&&0!==t){const i=Math.sqrt(e*e+t*t);e/=i,t/=i}return{x:e,y:t}}}class _{constructor(e){this.engine=e,this.entityManager=e.entityManager,this.componentRegistry=e.componentRegistry,this.systemManager=e.systemManager,this.eventBus=e.eventBus,this.renderer=e.renderer,this.camera=e.camera,this.inputState=new B,this.paused=!1,this.loaded=!1,this.gameSystems={playerMovement:null,investigation:null,factionReputation:null,knowledgeProgression:null,dialogue:null,cameraFollow:null}}async init(){console.log("[Game] Initializing The Memory Syndicate..."),this.registerComponentTypes(),this.initializeGameSystems(),await this.loadTestScene(),this.loaded=!0,console.log("[Game] Initialization complete")}registerComponentTypes(){console.log("[Game] Component types will be registered on first use")}initializeGameSystems(){console.log("[Game] Initializing game systems..."),this.gameSystems.investigation=new S(this.componentRegistry,this.eventBus),this.gameSystems.investigation.init(),this.gameSystems.playerMovement=new C(this.componentRegistry,this.eventBus,this.inputState),this.gameSystems.playerMovement.init(),this.gameSystems.factionReputation=new b(this.componentRegistry,this.eventBus),this.gameSystems.factionReputation.init(),this.gameSystems.knowledgeProgression=new F(this.componentRegistry,this.eventBus,this.gameSystems.investigation),this.gameSystems.knowledgeProgression.init(),this.gameSystems.dialogue=new M(this.componentRegistry,this.eventBus),this.gameSystems.dialogue.init(),this.gameSystems.cameraFollow=new I(this.componentRegistry,this.eventBus,this.camera),this.gameSystems.cameraFollow.init(),this.systemManager.registerSystem(this.gameSystems.playerMovement,10),this.systemManager.registerSystem(this.gameSystems.investigation,30),this.systemManager.registerSystem(this.gameSystems.factionReputation,25),this.systemManager.registerSystem(this.gameSystems.knowledgeProgression,35),this.systemManager.registerSystem(this.gameSystems.dialogue,40),this.systemManager.registerSystem(this.gameSystems.cameraFollow,90),console.log("[Game] Game systems initialized")}async loadTestScene(){console.log("[Game] Loading test scene..."),function(e,t,i=0,s=0){const n=e.createEntity();e.tagEntity(n,"player");const o=new T(i,s,0,1,1);t.addComponent(n,"Transform",o);const a=new x({image:null,width:32,height:48,layer:"entities",zIndex:10,color:"#00CCFF",visible:!0});t.addComponent(n,"Sprite",a);const r=new R({moveSpeed:v.player.moveSpeed,acceleration:v.player.acceleration,friction:v.player.friction});t.addComponent(n,"PlayerController",r);const l=new A({type:"AABB",width:28,height:40,offsetX:0,offsetY:4,isTrigger:!1,isStatic:!1,tags:["player","solid"]});t.addComponent(n,"Collider",l);const c=new E({primaryFaction:"civilian",reputation:{police:{fame:10,infamy:0},criminals:{fame:0,infamy:0},neurosynch:{fame:5,infamy:0},resistance:{fame:0,infamy:0}},currentDisguise:null,knownBy:new Set,relationshipModifiers:[{factionId:"police",modifier:1.1,reason:"former_officer"}]});t.addComponent(n,"FactionMember",c),console.log(`[PlayerEntity] Created player entity at (${i}, ${s})`)}(this.entityManager,this.componentRegistry,400,300),this.gameSystems.cameraFollow.snapTo(400,300);const e=[{x:300,y:200,title:"Fingerprint",type:"forensic",category:"fingerprint"},{x:500,y:250,title:"Security Log",type:"digital",category:"document"},{x:350,y:400,title:"Witness Statement",type:"testimony",category:"testimony"},{x:450,y:350,title:"Memory Fragment",type:"physical",category:"memory_chip"}];for(const t of e)P(this.entityManager,this.componentRegistry,{...t,id:`evidence_${t.title.toLowerCase().replace(/\s+/g,"_")}`,description:`A piece of evidence: ${t.title}`,caseId:"case_tutorial",derivedClues:[`clue_${t.category}`]});this.createBoundary(0,0,800,20),this.createBoundary(0,580,800,20),this.createBoundary(0,0,20,600),this.createBoundary(780,0,20,600),this.subscribeToGameEvents(),console.log("[Game] Test scene loaded")}createBoundary(e,t,i,s){const n=this.entityManager.createEntity();this.entityManager.tagEntity(n,"wall");const o=new T(e+i/2,t+s/2);this.componentRegistry.addComponent(n,"Transform",o);const a=new A({type:"AABB",width:i,height:s,isStatic:!0,isTrigger:!1,tags:["wall","solid"]});this.componentRegistry.addComponent(n,"Collider",a);const r=new x({width:i,height:s,color:"#333333",layer:"tiles",visible:!0});this.componentRegistry.addComponent(n,"Sprite",r)}subscribeToGameEvents(){this.eventBus.subscribe("evidence:collected",e=>{console.log(`[Game] Evidence collected: ${e.evidenceId}`)}),this.eventBus.subscribe("evidence:detected",e=>{}),this.eventBus.subscribe("clue:derived",e=>{console.log(`[Game] New clue: ${e.clueId} from ${e.evidenceId}`)}),this.eventBus.subscribe("reputation:changed",e=>{console.log(`[Game] Reputation changed: ${e.factionId} - ${e.newFame} fame, ${e.newInfamy} infamy`)}),this.eventBus.subscribe("gate:unlocked",e=>{console.log(`[Game] Gate unlocked: ${e.gateId}`)}),this.eventBus.subscribe("ability:unlocked",e=>{console.log(`[Game] Ability unlocked: ${e.abilityId}`)}),this.eventBus.subscribe("player:moved",e=>{})}update(e){this.loaded&&!this.paused&&this.inputState.isPressed("pause")&&this.togglePause()}togglePause(){this.paused=!this.paused,this.paused?(this.eventBus.emit("game:pause"),console.log("[Game] Paused")):(this.eventBus.emit("game:resume"),console.log("[Game] Resumed"))}cleanup(){console.log("[Game] Cleaning up..."),Object.values(this.gameSystems).forEach(e=>{e&&e.cleanup&&e.cleanup()}),this.inputState.reset(),console.log("[Game] Cleanup complete")}}window.addEventListener("DOMContentLoaded",async()=>{console.log("Starting The Memory Syndicate...");const e=document.getElementById("game-canvas");if(!e)return void console.error("Canvas element not found!");const t=new f(e);await t.init();const i=new _(t);await i.init();const s=document.getElementById("loading-screen");s&&s.classList.add("hidden");const n=document.getElementById("debug-overlay");let o=!1;window.addEventListener("keydown",e=>{"F3"===e.key&&(e.preventDefault(),o=!o,n&&n.classList.toggle("visible",o))}),setInterval(()=>{if(!o||!n)return;const e=document.getElementById("debug-fps"),i=document.getElementById("debug-entities"),s=document.getElementById("debug-memory"),a=document.getElementById("debug-frame-time");if(e&&(e.textContent=`FPS: ${t.getFPS()}`),i){const e=t.getEntityManager().getActiveEntityCount();i.textContent=`Entities: ${e}`}if(s&&performance.memory){const e=(performance.memory.usedJSHeapSize/1024/1024).toFixed(1);s.textContent=`Memory: ${e} MB`}if(a){const e=(1e3*t.getDeltaTime()).toFixed(1);a.textContent=`Frame: ${e} ms`}},500),t.start(),console.log("The Memory Syndicate started successfully!"),window.addEventListener("beforeunload",()=>{t.cleanup(),i.cleanup()})});
//# sourceMappingURL=index-ZZ-6MMsL.js.map
