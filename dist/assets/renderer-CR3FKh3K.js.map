{"version":3,"file":"renderer-CR3FKh3K.js","sources":["../../src/engine/renderer/Layer.js","../../src/engine/renderer/Camera.js","../../src/engine/renderer/Renderer.js"],"sourcesContent":["/**\n * Layer - represents a rendering layer with offscreen canvas.\n * Layers enable efficient partial redraws (only redraw changed layers).\n */\nexport class Layer {\n  constructor(name, width, height, zIndex = 0) {\n    this.name = name;\n    this.width = width;\n    this.height = height;\n    this.zIndex = zIndex;\n    this.canvas = document.createElement('canvas');\n    this.canvas.width = width;\n    this.canvas.height = height;\n    this.ctx = this.canvas.getContext('2d');\n    this.dirty = true;\n    this.visible = true;\n    this.opacity = 1.0;\n  }\n\n  clear() {\n    this.ctx.clearRect(0, 0, this.width, this.height);\n  }\n\n  markDirty() {\n    this.dirty = true;\n  }\n\n  markClean() {\n    this.dirty = false;\n  }\n\n  setOpacity(opacity) {\n    this.opacity = Math.max(0, Math.min(1, opacity));\n  }\n}\n","/**\n * Camera - viewport management and coordinate transforms.\n * Supports smooth following, screen shake, and world/screen coordinate conversion.\n */\nexport class Camera {\n  constructor(x = 0, y = 0, width = 1280, height = 720) {\n    this.x = x;\n    this.y = y;\n    this.width = width;\n    this.height = height;\n    this.zoom = 1.0;\n    this.followTarget = null;\n    this.followSpeed = 0.1;\n    this.shakeIntensity = 0;\n    this.shakeDecay = 0.9;\n    this.shakeOffsetX = 0;\n    this.shakeOffsetY = 0;\n  }\n\n  follow(entity, speed = 0.1) {\n    this.followTarget = entity;\n    this.followSpeed = speed;\n  }\n\n  update(deltaTime, getPosition) {\n    if (this.followTarget && getPosition) {\n      const pos = getPosition(this.followTarget);\n      if (pos) {\n        this.x += (pos.x - this.width / 2 - this.x) * this.followSpeed;\n        this.y += (pos.y - this.height / 2 - this.y) * this.followSpeed;\n      }\n    }\n\n    if (this.shakeIntensity > 0.1) {\n      this.shakeOffsetX = (Math.random() - 0.5) * this.shakeIntensity;\n      this.shakeOffsetY = (Math.random() - 0.5) * this.shakeIntensity;\n      this.shakeIntensity *= this.shakeDecay;\n    } else {\n      this.shakeIntensity = 0;\n      this.shakeOffsetX = 0;\n      this.shakeOffsetY = 0;\n    }\n  }\n\n  shake(intensity = 10) {\n    this.shakeIntensity = Math.max(this.shakeIntensity, intensity);\n  }\n\n  worldToScreen(worldX, worldY) {\n    return {\n      x: (worldX - this.x) * this.zoom + this.shakeOffsetX,\n      y: (worldY - this.y) * this.zoom + this.shakeOffsetY\n    };\n  }\n\n  screenToWorld(screenX, screenY) {\n    return {\n      x: (screenX - this.shakeOffsetX) / this.zoom + this.x,\n      y: (screenY - this.shakeOffsetY) / this.zoom + this.y\n    };\n  }\n\n  contains(x, y, margin = 0) {\n    return x >= this.x - margin && x <= this.x + this.width + margin &&\n           y >= this.y - margin && y <= this.y + this.height + margin;\n  }\n}\n","/**\n * Renderer - main rendering coordinator with layered rendering.\n * Performance: Target <8ms per frame.\n * TODO: Add dirty rectangle optimization for static layers.\n */\nimport { Layer } from './Layer.js';\nimport { Camera } from './Camera.js';\n\nexport class Renderer {\n  constructor(canvas) {\n    this.canvas = canvas;\n    this.ctx = canvas.getContext('2d');\n    this.width = canvas.width;\n    this.height = canvas.height;\n    this.camera = new Camera(0, 0, this.width, this.height);\n    this.layers = new Map();\n    this._initLayers();\n  }\n\n  _initLayers() {\n    const layerConfigs = [\n      { name: 'background', zIndex: 0 },\n      { name: 'tiles', zIndex: 1 },\n      { name: 'entities', zIndex: 2 },\n      { name: 'effects', zIndex: 3 },\n      { name: 'ui', zIndex: 4 }\n    ];\n\n    layerConfigs.forEach(config => {\n      const layer = new Layer(config.name, this.width, this.height, config.zIndex);\n      this.layers.set(config.name, layer);\n    });\n  }\n\n  getLayer(name) {\n    return this.layers.get(name);\n  }\n\n  render(componentRegistry) {\n    this.ctx.clearRect(0, 0, this.width, this.height);\n\n    const sortedLayers = Array.from(this.layers.values()).sort((a, b) => a.zIndex - b.zIndex);\n\n    for (const layer of sortedLayers) {\n      if (!layer.visible) {\n        continue;\n      }\n\n      this.ctx.globalAlpha = layer.opacity;\n      this.ctx.drawImage(layer.canvas, 0, 0);\n      this.ctx.globalAlpha = 1.0;\n    }\n  }\n\n  clear() {\n    this.ctx.clearRect(0, 0, this.width, this.height);\n    for (const layer of this.layers.values()) {\n      layer.clear();\n    }\n  }\n}\n"],"names":["Layer","constructor","name","width","height","zIndex","this","canvas","document","createElement","ctx","getContext","dirty","visible","opacity","clear","clearRect","markDirty","markClean","setOpacity","Math","max","min","Camera","x","y","zoom","followTarget","followSpeed","shakeIntensity","shakeDecay","shakeOffsetX","shakeOffsetY","follow","entity","speed","update","deltaTime","getPosition","pos","random","shake","intensity","worldToScreen","worldX","worldY","screenToWorld","screenX","screenY","contains","margin","Renderer","camera","layers","Map","_initLayers","forEach","config","layer","set","getLayer","get","render","componentRegistry","sortedLayers","Array","from","values","sort","a","b","globalAlpha","drawImage"],"mappings":"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"}