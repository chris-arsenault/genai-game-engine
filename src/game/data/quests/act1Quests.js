/**
 * Act 1 Quest Definitions: The Hollow Case
 *
 * Act 1 introduces the mystery of "hollow" victims whose consciousness has been extracted.
 * Detective Kira Voss investigates the pattern, uncovers NeuroSync's involvement,
 * and gains access to Mid-City along with the Memory Trace ability.
 *
 * Duration: 2-3 hours
 * Setting: Neon Districts (lower city)
 * Mystery: Who is extracting memories and why?
 */

/**
 * Case 001: "The Hollow Case" - Tutorial Quest
 *
 * The opening investigation that introduces core mechanics:
 * - Evidence collection
 * - Detective vision
 * - Deduction board
 * - Forensic analysis
 * - NPC interviews
 */
export const QUEST_001_HOLLOW_CASE = {
  id: 'case_001_hollow_case',
  title: 'The Hollow Case',
  type: 'main',
  act: 'act1',

  description: 'Your former partner Alex has become a "hollow" - their consciousness extracted, leaving only an empty shell. Investigate the crime scene to find out who did this and why.',

  autoStart: true, // Starts immediately on game begin

  prerequisites: {
    storyFlags: [] // No prerequisites for first quest
  },

  objectives: [
    {
      id: 'obj_arrive_scene',
      description: 'Arrive at the crime scene',
      trigger: {
        event: 'area:entered',
        areaId: 'crime_scene_alley'
      },
      optional: false,
      hidden: false
    },
    {
      id: 'obj_examine_body',
      description: 'Examine Alex\'s body',
      trigger: {
        event: 'evidence:collected',
        count: 1
      },
      optional: false
    },
    {
      id: 'obj_collect_evidence',
      description: 'Collect all evidence at the scene (0/3)',
      trigger: {
        event: 'evidence:collected',
        count: 3
      },
      optional: false
    },
    {
      id: 'obj_interview_witness',
      description: 'Interview the witness',
      trigger: {
        event: 'npc:interviewed',
        npcId: 'witness_street_vendor'
      },
      optional: false
    },
    {
      id: 'obj_consult_black_market_broker',
      description: 'Secure transit intel from the black market broker',
      trigger: {
        event: 'knowledge:learned',
        knowledgeId: 'black_market_transit_routes'
      },
      optional: true
    },
    {
      id: 'obj_unlock_detective_vision',
      description: 'Learn to use Detective Vision',
      trigger: {
        event: 'ability:unlocked',
        abilityId: 'detective_vision'
      },
      optional: false
    },
    {
      id: 'obj_find_hidden_evidence',
      description: 'Use Detective Vision to find hidden evidence',
      trigger: {
        event: 'evidence:collected',
        count: 5 // Total evidence including hidden
      },
      optional: false
    },
    {
      id: 'obj_analyze_neural_extractor',
      description: 'Analyze the neural extraction device',
      trigger: {
        event: 'knowledge:learned',
        knowledgeId: 'neural_extractor_tech'
      },
      optional: false
    },
    {
      id: 'obj_connect_clues',
      description: 'Connect clues on the deduction board',
      trigger: {
        event: 'theory:validated',
        theoryId: 'theory_hollow_case'
      },
      optional: false
    },
    {
      id: 'obj_report_findings',
      description: 'Report findings to Captain Reese',
      trigger: {
        event: 'dialogue:completed',
        npcId: 'captain_reese'
      },
      optional: false
    }
  ],

  rewards: {
    abilityUnlock: 'memory_trace',
    storyFlags: [
      'case_001_solved',
      'act1_progress_1',
      'knows_hollow_victims',
      'knows_neurosynch_connection'
    ],
    factionReputation: {
      'police': 10,
      'neurosynch': -5
    }
  },

  branches: [
    {
      condition: { storyFlags: ['case_001_solved'] },
      nextQuest: 'case_002_following_pattern'
    }
  ]
};

/**
 * Case 002: "Following the Pattern" - Procedural Quest
 *
 * Kira discovers multiple hollow victims with similar extraction signatures.
 * This is a procedural quest generated by the CaseGenerator.
 */
export const QUEST_002_FOLLOWING_PATTERN = {
  id: 'case_002_following_pattern',
  title: 'Following the Pattern',
  type: 'main',
  act: 'act1',

  description: 'Multiple hollow victims have been found across the Neon Districts. Investigate the pattern to identify the perpetrators.',

  autoStart: false, // Started by completing Case 001

  prerequisites: {
    storyFlags: ['case_001_solved']
  },

  objectives: [
    {
      id: 'obj_investigate_scenes',
      description: 'Investigate three crime scenes (0/3)',
      trigger: {
        event: 'case:solved',
        count: 3
      },
      optional: false
    },
    {
      id: 'obj_analyze_extraction_patterns',
      description: 'Analyze extraction patterns',
      trigger: {
        event: 'knowledge:learned',
        knowledgeId: 'extraction_pattern_analysis'
      },
      optional: false
    },
    {
      id: 'obj_identify_neurosynch_link',
      description: 'Identify NeuroSync connection',
      trigger: {
        event: 'theory:validated',
        theoryId: 'theory_neurosynch_link'
      },
      optional: false
    },
    {
      id: 'obj_optional_informant',
      description: 'Find informant with intel on Memory Parlors',
      trigger: {
        event: 'npc:interviewed',
        npcId: 'informant_jax'
      },
      optional: true // Optional objective provides bonus info
    }
  ],

  rewards: {
    storyFlags: [
      'case_002_solved',
      'act1_progress_2',
      'knows_memory_parlors'
    ],
    factionReputation: {
      'police': 15,
      'neurosynch': -10,
      'independents': 5
    }
  },

  branches: [
    {
      condition: {
        storyFlags: ['case_002_solved'],
        obj_optional_informant: true
      },
      nextQuest: 'case_003_memory_parlor' // Got informant intel, can infiltrate
    },
    {
      condition: {
        storyFlags: ['case_002_solved']
      },
      nextQuest: 'case_004_informant_network' // Need to build informant network first
    }
  ]
};

/**
 * Case 003: "Memory Parlor" - Infiltration Quest
 *
 * Kira infiltrates an illegal Memory Parlor where extracted memories are traded.
 * Introduces faction disguise mechanics and stealth gameplay.
 */
export const QUEST_003_MEMORY_PARLOR = {
  id: 'case_003_memory_parlor',
  title: 'Memory Parlor',
  type: 'main',
  act: 'act1',

  description: 'Infiltrate the illegal Memory Parlor in the undercity to gather evidence on the memory extraction operation.',

  autoStart: false,

  prerequisites: {
    storyFlags: ['case_002_solved', 'knows_memory_parlors']
  },

  objectives: [
    {
      id: 'obj_acquire_disguise',
      description: 'Acquire civilian disguise',
      trigger: {
        event: 'knowledge:learned',
        knowledgeId: 'disguise_civilian'
      },
      optional: false
    },
    {
      id: 'obj_locate_parlor',
      description: 'Locate the Memory Parlor entrance',
      trigger: {
        event: 'area:entered',
        areaId: 'memory_parlor_entrance'
      },
      optional: false
    },
    {
      id: 'obj_infiltrate_parlor',
      description: 'Enter the Memory Parlor without detection',
      trigger: {
        event: 'area:entered',
        areaId: 'memory_parlor_interior'
      },
      optional: false
    },
    {
      id: 'obj_gather_intel',
      description: 'Gather intel on extraction operations',
      trigger: {
        event: 'evidence:collected',
        count: 4
      },
      optional: false
    },
    {
      id: 'obj_download_client_list',
      description: 'Download client database',
      trigger: {
        event: 'knowledge:learned',
        knowledgeId: 'memory_parlor_clients'
      },
      optional: false
    },
    {
      id: 'obj_encounter_eraser',
      description: 'Encounter "Eraser" agent',
      trigger: {
        event: 'dialogue:completed',
        npcId: 'eraser_agent_cipher'
      },
      optional: false
    },
    {
      id: 'obj_escape_parlor',
      description: 'Escape the Memory Parlor',
      trigger: {
        event: 'area:entered',
        areaId: 'neon_districts_street'
      },
      optional: false
    }
  ],

  rewards: {
    storyFlags: [
      'case_003_solved',
      'act1_progress_3',
      'knows_eraser_agents',
      'discovered_curator_network',
      'ability_disguise_system'
    ],
    factionReputation: {
      'police': 20,
      'neurosynch': -20,
      'curators': -15 // Discovered their network
    }
  },

  branches: [
    {
      condition: { storyFlags: ['case_003_solved'] },
      nextQuest: 'case_005_memory_drive'
    }
  ]
};

/**
 * Case 004: "Informant Network" - NPC Relationship Quest
 *
 * Build an informant network to gain intel on Memory Parlor locations.
 * Focuses on NPC interactions, dialogue, and faction relationships.
 */
export const QUEST_004_INFORMANT_NETWORK = {
  id: 'case_004_informant_network',
  title: 'Informant Network',
  type: 'main',
  act: 'act1',

  description: 'Build a network of informants to locate illegal Memory Parlors operating in the Neon Districts.',

  autoStart: false,

  prerequisites: {
    storyFlags: ['case_002_solved']
  },

  objectives: [
    {
      id: 'obj_meet_jax',
      description: 'Meet with informant Jax',
      trigger: {
        event: 'npc:interviewed',
        npcId: 'informant_jax'
      },
      optional: false
    },
    {
      id: 'obj_help_jax',
      description: 'Complete Jax\'s favor (retrieve stolen data)',
      trigger: {
        event: 'case:solved',
        caseId: 'side_jax_favor'
      },
      optional: false
    },
    {
      id: 'obj_recruit_informants',
      description: 'Recruit street informants (0/3)',
      trigger: {
        event: 'npc:interviewed',
        count: 3
      },
      optional: false
    },
    {
      id: 'obj_gain_parlor_intel',
      description: 'Gain Memory Parlor location',
      trigger: {
        event: 'knowledge:learned',
        knowledgeId: 'memory_parlor_location'
      },
      optional: false
    }
  ],

  rewards: {
    storyFlags: [
      'case_004_solved',
      'act1_progress_3',
      'knows_memory_parlors',
      'has_informant_network'
    ],
    factionReputation: {
      'independents': 20,
      'police': 5
    }
  },

  branches: [
    {
      condition: { storyFlags: ['case_004_solved'] },
      nextQuest: 'case_003_memory_parlor'
    }
  ]
};

/**
 * Case 005: "The Memory Drive" - Act 1 Climax
 *
 * Kira recovers a memory drive showing evidence destruction, gains access to Mid-City,
 * and unlocks the Memory Trace ability. Act 1 conclusion.
 */
export const QUEST_005_MEMORY_DRIVE = {
  id: 'case_005_memory_drive',
  title: 'The Memory Drive',
  type: 'main',
  act: 'act1',

  description: 'A memory drive recovered from the Memory Parlor contains encrypted data. Decrypt it to uncover the truth behind the hollow victims.',

  autoStart: false,

  prerequisites: {
    storyFlags: ['case_003_solved']
  },

  objectives: [
    {
      id: 'obj_analyze_drive',
      description: 'Analyze the encrypted memory drive',
      trigger: {
        event: 'knowledge:learned',
        knowledgeId: 'encrypted_memory_drive'
      },
      optional: false
    },
    {
      id: 'obj_find_decryption_key',
      description: 'Find decryption key',
      trigger: {
        event: 'evidence:collected',
        count: 2 // Collect key fragments
      },
      optional: false
    },
    {
      id: 'obj_decrypt_drive',
      description: 'Decrypt the memory drive',
      trigger: {
        event: 'knowledge:learned',
        knowledgeId: 'drive_decrypted'
      },
      optional: false
    },
    {
      id: 'obj_witness_memory',
      description: 'Witness the extracted memory',
      trigger: {
        event: 'dialogue:completed',
        npcId: 'memory_playback_system'
      },
      optional: false
    },
    {
      id: 'obj_confront_reese',
      description: 'Confront Captain Reese with the evidence',
      trigger: {
        event: 'dialogue:completed',
        npcId: 'captain_reese'
      },
      optional: false
    },
    {
      id: 'obj_gain_midcity_access',
      description: 'Gain credentials to Mid-City',
      trigger: {
        event: 'knowledge:learned',
        knowledgeId: 'midcity_credentials'
      },
      optional: false
    }
  ],

  rewards: {
    abilityUnlock: 'memory_trace_advanced',
    storyFlags: [
      'case_005_solved',
      'act1_complete',
      'act2_started',
      'midcity_unlocked',
      'knows_evidence_destruction',
      'reese_suspicious'
    ],
    factionReputation: {
      'police': -10, // Reese is suspicious
      'archivists': 10 // Resistance becomes interested
    }
  },

  branches: [
    {
      condition: { storyFlags: ['act1_complete'] },
      nextQuest: 'act2_choice_intro' // Act 2 branching introduction
    }
  ]
};

/**
 * All Act 1 Quests
 */
export const ACT1_QUESTS = [
  QUEST_001_HOLLOW_CASE,
  QUEST_002_FOLLOWING_PATTERN,
  QUEST_003_MEMORY_PARLOR,
  QUEST_004_INFORMANT_NETWORK,
  QUEST_005_MEMORY_DRIVE
];

/**
 * Register Act 1 quests with QuestManager
 * @param {QuestManager} questManager
 */
export function registerAct1Quests(questManager) {
  for (const quest of ACT1_QUESTS) {
    questManager.registerQuest(quest);
  }
  console.log('[Act1Quests] Registered 5 Act 1 quests');
}
